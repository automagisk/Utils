<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Saga Observer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="HttpSagaObserverClient.css">
    <script src='https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="header-title">Saga Observer</h1>
            <div class="header-actions">
                <button class="btn" onclick='retry()' title="Retries the current state if stopped or stalled."><i class="fas fa-redo"></i> Retry</button>
                <button class="btn" onclick='pause()' title="Pauses a running saga."><i class="fas fa-pause"></i> Pause</button>
                <button class="btn" onclick='resume()' title="Resumes a running saga."><i class="fas fa-play"></i> Resume</button>
                <button class="btn btn-danger" onclick='remove()' title="Removes the saga state. Avoid doing this on a running saga."><i class="fas fa-trash"></i> Remove</button>
                <button class="btn btn-danger" onclick='restart()' title="Removes the saga and sends the start event again."><i class="fas fa-power-off"></i> Restart</button>
                <!-- ko if: lastError -->
                <button class="btn btn-warning" onclick="showLastError()"><i class="fas fa-exclamation-triangle"></i> Last Error</button>
                <!-- /ko -->
            </div>
        </header>
        <main class="main-content">
            <div class="log-container" data-bind="with: log">
                <div class="log-header">
                    <h2>Consumed Events</h2>
                    <span class="event-count" data-bind="text: logScopes().length + ' event(s)'"></span>
                </div>
                <div class="log-content" data-bind="if: logScopes().length > 0">
                    <!-- ko foreach: logScopes -->
                    <div class="log-scope">
                        <div class="scope-header" data-bind="click: $parent.toggleScope, css: { collapsed: !expanded() }">
                            <span class="scope-toggle" data-bind="css: { expanded: expanded() }"><i class="fas fa-chevron-right"></i></span>
                            <div class="scope-title" data-bind="text: messageType"></div>
                            <div class="message-id" data-bind="text: formattedStart"></div>
                        </div>
                        <!-- ko if: expanded -->
                        <div class="log-entries" data-bind="foreach: entries">
                            <div class="log-entry">
                                <div class="log-timestamp" data-bind="text: formattedOffset"></div>
                                <div class="log-details">
                                    <span class="log-level" data-bind="text: logLevelText, css: 'log-level-' + logLevel"></span>
                                    <span class="log-message" data-bind="text: message"></span>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>
                <!-- ko if: logScopes().length === 0 -->
                <div class="empty-state">
                    <p>No log data available.</p>
                </div>
                <!-- /ko -->
            </div>

            <div class="graph-container">
                <div class="current-state" data-bind="text: currentState, style: { color: lastError() ? '#e74c3c' : '#2c3e50' }"></div>
                <div class="mermaid" id="graph">
                    {{mermaid}}
                </div>
            </div>
        </main>
    </div>
    <script src="HttpSagaObserverClient.js"></script>
</body>
</html>
